CoulombVertexReader [
  (file "../../resources/CoulombVertex.bin")
] [
  (CoulombVertex FullCoulombVertex)
  HoleEigenEnergies ParticleEigenEnergies
].

CoulombVertexSingularVectors [
  FullCoulombVertex
% (fieldVariablesSize 32)
% (fieldVariablesRank 0.5)
] [
  CoulombVertexSingularVectors
  CoulombVertexSingularValues
].

ApproximateCoulombVertex [
  FullCoulombVertex
  CoulombVertexSingularVectors
] [
  CoulombVertex
].

CoulombIntegralsFromVertex [
  CoulombVertex HoleEigenEnergies ParticleEigenEnergies
  (complex 1)
] [
  PHPHCoulombIntegrals
  PPHHCoulombIntegrals
  PHHPCoulombIntegrals
  HHPPCoulombIntegrals
  HHHHCoulombIntegrals
  HHHPCoulombIntegrals
  PHHHCoulombIntegrals
].

CcsdEnergyFromCoulombIntegrals [
  CoulombVertex
  PHPHCoulombIntegrals
  PPHHCoulombIntegrals
  PHHPCoulombIntegrals
  HHPPCoulombIntegrals
  HHHHCoulombIntegrals
  HHHPCoulombIntegrals
  PHHHCoulombIntegrals
  ParticleEigenEnergies HoleEigenEnergies
  (maxIterations 24)
% (integralsSliceSize 12)
% (integralsSliceFactor 0.33)
] [
  (CcsdEnergy CcsdEnergy) 
  (CcsdSinglesAmplitudes CcsdSinglesAmplitudes)
  (CcsdDoublesAmplitudes CcsdDoublesAmplitudes)
].

TensorWriter [(Data CcsdEnergy)] [].

CoulombVertexDecomposition [
  CoulombVertex
  % Set the rankSize or the rankFactor (relative to NG) of
  % the decomposed tensor and the number of iterations.
  % If both are given, rankSize is taken into account.
  (rankSize 99)
  (rankFactor 3.0)
  (maxIterations 64)
  (mixer "LinearMixer")
  (mixingRatio 0.8)
  % Choose the ansatz, one of "quadratic", "positiveDefinite", "pseudoInverse"
  (coulombVertexDecompositionAnsatz "positiveDefinite")
] [
  FactorOrbitals CoulombFactors
  % Returns (if given) the Coulomb Vertex from the decomposed tensors.
  ComposedCoulombVertex
].

CcsdEnergyFromCoulombIntegrals [
  CoulombVertex
  FactorOrbitals
  CoulombFactors
  PHPHCoulombIntegrals
  PPHHCoulombIntegrals
  PHHPCoulombIntegrals
  HHPPCoulombIntegrals
  HHHHCoulombIntegrals
  HHHPCoulombIntegrals
  PHHHCoulombIntegrals
  ParticleEigenEnergies HoleEigenEnergies
  (maxIterations 24)
% (factorsSliceSize 64)
% (factorsSliceFactor 0.33)
% (mixer "LinearMixer")
% (mixingRatio 1.5)
  % Specify the decomposition ansatz, one of "quadratic", "positiveDefinite", "pseudoInverse"
  (coulombVertexDecompositionAnsatz "positiveDefinite")
] [
  (CcsdEnergy CcsdEnergyFactors)
  (CcsdSinglesAmplitudes CcsdSinglesAmplitudesFactors)
  (CcsdDoublesAmplitudes CcsdDoublesAmplitudesFactors)
].

TensorWriter [(Data CcsdEnergyFactors)] [].
